<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:C64UViewer.ViewModels"
        xmlns:conv="using:C64UViewer.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="C64UViewer.Views.MainWindow"
        Icon="/Assets/icon.ico"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding AppTitle}"
        Background="#1C1C1C"
        Foreground="White"
        Width="900" Height="650"
        WindowStartupLocation="CenterOwner">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <conv:StatusColorConverter x:Key="StatusColorConverter"/>
        <conv:StreamButtonTextConverter x:Key="StreamButtonTextConverter"/>
        <conv:StreamButtonColorConverter x:Key="StreamButtonColorConverter"/>
    </Window.Resources>

    <Window.Styles>
        <Style Selector="Button">
            <Setter Property="Background" Value="#44A044" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Transitions">
                <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Button:disabled /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="#2A3A2A" /> 
            <Setter Property="Foreground" Value="#666666" /> 
            <Setter Property="Opacity" Value="0.8" />
        </Style>

        <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
            <Setter Property="Background" Value="#55C055" />
            <Setter Property="TextBlock.Foreground" Value="White" />
        </Style>

        <Style Selector="Button.UpdateBanner[IsVisible=True]">
            <Style.Animations>
                <Animation Duration="0:0:0.6" FillMode="Forward" Easing="CubicEaseOut">
                    <KeyFrame KeyTime="0:0:0">
                        <Setter Property="Opacity" Value="0"/>
                        <Setter Property="TranslateTransform.Y" Value="-20"/>
                    </KeyFrame>
                    <KeyFrame KeyTime="0:0:0.6">
                        <Setter Property="Opacity" Value="1"/>
                        <Setter Property="TranslateTransform.Y" Value="0"/>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
    </Window.Styles>

    <DockPanel Margin="10">
        <Button DockPanel.Dock="Top" 
                Classes="UpdateBanner"
                Command="{Binding OpenUpdateUrl}"
                IsVisible="{Binding IsUpdateAvailable}"
                Background="#2196F3" 
                Foreground="White"
                HorizontalAlignment="Stretch"
                CornerRadius="5"
                Padding="8"
                Cursor="Hand"
                Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <PathIcon Data="{StaticResource arrow_down_circle_regular}" Margin="0,0,10,0" Foreground="White"/>
                <TextBlock Text="{Binding LatestVersionText}" VerticalAlignment="Center" FontWeight="Bold"/>
            </StackPanel>
        </Button>

        <StackPanel DockPanel.Dock="Top" Spacing="15" Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal" Spacing="20" VerticalAlignment="Center">
                
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="C64U IP:" VerticalAlignment="Center" Foreground="#AAAAAA"/>
                    <TextBox Text="{Binding U64IpAddress}" Width="130" VerticalContentAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="Your IP:" VerticalAlignment="Center" Foreground="#AAAAAA"/>
                    <Border Background="#333333" CornerRadius="4" Padding="8,4">
                        <TextBlock Text="{Binding LocalIpAddress}" 
                                   FontWeight="Bold" 
                                   Foreground="White" 
                                   VerticalAlignment="Center"/>
                    </Border>
                </StackPanel>

                <Button Content="{Binding IsStreaming, Converter={StaticResource StreamButtonTextConverter}}" 
                        Command="{Binding ToggleStreamCommand}" 
                        Background="{Binding IsStreaming, Converter={StaticResource StreamButtonColorConverter}}"
                        IsEnabled="{Binding !IsBusy}" />

                <Button Content="Help" Command="{Binding ShowHelpCommand}" Background="#555555" />

                <Grid Height="4" Width="100"> 
                    <ProgressBar IsIndeterminate="True" 
                                 IsVisible="{Binding IsBusy}" 
                                 Foreground="SpringGreen"
                                 Background="Transparent"
                                 VerticalAlignment="Top"/>
                </Grid>
            </StackPanel>
            
            <TextBlock Text="{Binding StatusMessage}" 
                       Foreground="{Binding StatusMessage, Converter={StaticResource StatusColorConverter}}"
                       FontSize="14" 
                       FontStyle="Normal"/>
        </StackPanel>

        <Border Background="Black" CornerRadius="5" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
            <Viewbox Stretch="Uniform">
                <Image x:Name="C64Display" 
                       Source="{Binding ScreenBitmap}" 
                       Width="384" Height="272"
                       Stretch="Uniform"
                       RenderOptions.BitmapInterpolationMode="None" />
            </Viewbox>
        </Border>
    </DockPanel>
</Window>